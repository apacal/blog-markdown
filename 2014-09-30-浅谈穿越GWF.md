# 浅谈穿越GWF

## What

自从李开复离开google（google离开大陆后）,功夫王就把Google全部屏蔽了， 只能使用baidu，虽然baidu在中文搜索还可以，但是对于程序员来说没有google就是个噩梦，本文介绍如何简单的用上google。
　　


## How

先介绍一点基础知识
### GFW（功夫王）

### 功夫王介绍

GFW是Great Fire Wall的缩写，即“长城防火墙”，也叫“功夫王”。这个工程由若干个部分组成，实现不同功能。  

长城防火墙主要指TG监控和过滤互联网内容的软硬件系统，由服务器和路由器等设备，加上相关的应用程序所构成。   

首先，需要强调的是，由于中国网络审查广泛，中国国内含有“不合适”内容的的网站，会受到政府直接的行政干预，被要求自我审查、自我监管，乃至关闭，所以GFW的主要作用在于分析和过滤中国境内外网络的资讯互相访问。   

GFW对网络内容的过滤和分析是双向的，GFW不仅针对国内读者访问中国境外的网站进行干扰，也干扰国外读者访问主机在中国大陆的网站。    

### 功夫王功夫

#### 关键字过滤阻断

关键字过滤系统。此系统能够从出口网关收集分析信息，过滤、嗅探指定的关键字。   

主要针对HTTP的默认端口：80端口，因为HTTP传播的内容是明文的内 容，没有经过加密，而GFW是一个IDS(Intrusion detection system)。   

普通的关键词如果出现在HTTP请求报文的头部(如“Host: www.youtube.com”)时，则会马上伪装成对方向连接两端的计算机发送RST包(reset)干扰两者正常的TCP连接，进而使请求的内容无法继续查看。  

如果GFW在数据流中发现了特殊的内文关键词(如达赖等)时，其也会试图打断当前的连接，从而有时会出现网页开启一部分后突然停止的情况。在任何阻断发生后，一般在随后的90秒内同一IP地址均无法浏览对应IP地址相同端口上的内容。   

#### IP地址封锁

IP 地址封锁是GFW通过路由器来控制的，在通往国外的最后一个网关上加上一条伪造的路由规则，导致通往某些被屏蔽的网站的所有IP数据包无法到达。  

路由器的正常工作方式是学习别的路由器广播的路由规则，遇到符合已知的IP转发规则的数据包，则按已经规则发送，遇到未知规则IP的数据，则转发到上一级网关。   

而GFW对于境外(中国大陆以外)的XX网站会采取独立IP封锁技术。然而部分XX网站使用的是由虚拟主机服务提供商提供的多域名、单(同)IP的主机托管 服务，这就会造成了封禁某个IP地址，就会造成所有使用该服务提供商服务的其它使用相同IP地址服务器的网站用户一同遭殃，就算是正常的网站，也不能幸免。其中的内容可能并无不当之处，但也不能在中国大陆正常访问。现在GFW通常会将包含XX信息的网站或网页的URL加入关键字过滤系统，并可以防止民众透过普通海外HTTP代理服务器进行访问。

#### 特定端口封锁

GFW会丢弃特定IP地址上特定端口的所有数据包，使该IP地址上服务器的部分功能(如SSH的22、VPN的1723或SSL的443端口等)无法在中国大陆境内正常使用。 在中国移动、中国联通等部分ISP(手机IP段)，所有的PPTP类型的VPN都被封锁。    

2011 年3月起，GFW开始对Google部分服务器的IP地址实施自动封锁(按时间段)某些端口，按时段对www.google.com(用户登录所有 Google服务时需此域名加密验证)和mail.google.com的几十个IP地址的443端口实施自动封锁，具体是每10或15分钟可以连通，接着断开，10或15分钟后再连通，再断开，如此循环，令中国大陆用户和Google主机之间的连接出现间歇性中断，使其各项服务出现问题。GFW这样的封锁手法很高明，因为Gmail并非被完全阻断，这令问题看上去好像出自Google本身。这就是你们认为Google抽风的原因。  

#### SSL连接阻断

GFW会阻断特定网站的SSL加密连接，方法是通过伪装成对方向连接两端的计算机发送RST包(RESET)干扰两者间正常的TCP连接，进而打断与特定IP地址之间的SSL(HTTPS，443端口)握手(如Gmail、Google文件、Google网上论坛等的SSL加密连接)，从而导致SSL连接失败。 当然由于SSL本身的特点，这并不意味着与网站传输的内容可被破译。    

#### DNS劫持和污染

GFW主要采用DNS劫持和污染技术，使用Cisco提供的IDS系统来进行域名劫持，防止访问被过滤的网站，2002年Google被封锁期间其域名就被劫持到百度。中国部分ISP也会通过此技术插入广告。 对于含有多个IP地址或经常变更IP地址逃避封锁的域名，GFW通常会使用此方法进行封锁。具体方法是当用户向DNS服务器提交域名请求时，DNS返回虚假(或不解析)的IP地址。 全球一共有13组根域名服务器(Root Server)，目前中国大陆有F、I这2个根域DNS镜像，但现在均已因为多次DNS污染外国网络，而被断开与国际互联网的连接。 DNS劫持和污染是针对某些网站的最严重的干扰。  

　　干扰的方式有两种：  
　　一种是通过网络服务提供商(Internet Service Provider)提供的DNS服务器进行DNS欺骗，当人们访问某个网站时，需要要把域名转换为一个IP地址，DNS服务器负责将域名转换为IP地址， 中国大陆的ISP接受通信管理局的屏蔽网站的指令后在DNS服务器里加入某些特定域名的虚假记录，当使用此DNS服务器的网络用户访问此特定网站 时，DNS服务便给出虚假的IP地址，导致访问网站失败，甚至返回ISP运营商提供的出错页面和广告页面。  
　　另一种是GFW在DNS查询使用的UDP的53端口上根据blacklist进行过滤，遇到通往国外的使用UDP53端口进行查询的DNS请求，就返回一个虚假的IP地址。  

说了那么多，下面来解决方案。
### 解决方案

#### 修改hosts
Hosts是一个没有扩展名的系统文件，可以用记事本（VIM)等工具打开，其作用就是将一些常用的网址域名与其对应的IP地址建立一个关联“数据库”，当用户在浏览器中输入一个需要登录的网址时，系统会首先自动从Hosts文件中寻找对应的IP地址，一旦找到，系统会立即打开对应网页，如果没有找到，则系统再会将网址提交DNS域名解析服务器进行IP地址的解析。   

修改hosts就是破解GFW的第五种方式，我们找到系统的hosts，修改或者替换就可以了。   

类UNIX存放位置:  /etc   

windows存放位置：C:\WINDOWS\system32\drivers\etc   




#### 使用vpn

vpn(Virtual Private Network 虚拟专用网络)功能是：在公用网络上建立专用网络，进行加密通讯。在企业网络中有广泛应用。VPN网关通过对数据包的加密和数据包目标地址的转换实现远程访问。VPN有多种分类方式，主要是按协议进行分类。VPN可通过服务器、硬件、软件等多种方式实现。VPN具有成本低，易于使用的特点。   

vpn通过建立加密隧道，使得GFW对你访问的东西完全不知道，也就不能进行拦截。而VPN一般是需要收费的并且是按流量来算的，我们可以去买一个VPS。然后自己搭建一个VPN服务器。
关于如何搭建VPN，可以看我的在这篇文章：[VPS下安装VPN（Ubuntu)](apacal.cn/article/50.html)

#### 使用ssh

SSH 为 Secure Shell 的缩写，由 IETF 的网络工作小组（Network Working Group）所制定；SSH 为建立在应用层和传输层基础上的安全协议。SSH 是目前较可靠，专为远程登录会话和其他网络服务提供安全性的协议。利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题。SSH最初是UNIX系统上的一个程序，后来又迅速扩展到其他操作平台。SSH在正确使用时可弥补网络中的漏洞。SSH客户端适用于多种平台。几乎所有U NIX平台—包括HP-UX、Linux、AIX、Solaris、Digital UNIX、Irix，以及其他平台，都可运行SSH。  

关于ssh的知识可以看一下阮一峰老师的这篇文章：[SSH原理与运用：远程登录 & 远程操作 & 端口转发](apacal.cn/article/64.html)

我们可以使用ssh进行端口转发，在配合浏览器的插件Auto Proxy等对特定域名使用sshd来访问，使用加密隧道。

ssh　端口转发命令
```
ssh -qTfnN -D 7070 apacal@vpn.apacal.cn
```

## We

我们提供３种方法来穿越GFW, 第一修改hosts的方法，必须要把域名在大陆可以访问的ip添加到hosts文件中，如果没有就不能访问，而vpn对于全部外国网站基本都可以访问，前提必须需要一个vpn，并且对于当你要访问大陆网站时，数据包绕了个圈回来，速度会变慢，好处是小白都可以用，没有那么多弊端。第三种也需要一个VPS，并且需要一定技术，但是弄好了，比较智能，访问大陆网站就不使用ssh转发，加快速度。  

总的来说，修改hosts和vpn是最简单的，对于手机，安卓也可以修改host。   

然而，hosts的ip会经常被禁用掉，可以使用[hoststool](https://github.com/huhamhire/huhamhire-hosts/)来更新最新的hosts文件。
  
